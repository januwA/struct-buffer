!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.StructBuffer=e():t.StructBuffer=e()}(this,(function(){return(()=>{"use strict";var t={608:(t,e,n)=>{n.r(e),n.d(e,{BOOL:()=>j,BYTE:()=>R,CHAR:()=>I,DWORD:()=>A,FLOAT:()=>G,INT:()=>$,LONG:()=>P,LONGLONG:()=>F,QWORD:()=>E,SHORT:()=>C,StructBuffer:()=>k,UCHAR:()=>B,UINT:()=>v,ULONG:()=>W,ULONGLONG:()=>Y,USHORT:()=>H,WORD:()=>z,char:()=>g,defaultTypes:()=>q,display:()=>Q,double:()=>L,float:()=>m,int:()=>f,int16_t:()=>N,int32_t:()=>x,int64_t:()=>w,int8_t:()=>b,long:()=>p,longlong:()=>_,parseCStruct:()=>K,registerType:()=>o,short:()=>d,sizeof:()=>M,string_t:()=>c,typedef:()=>u,uchar:()=>a,uint:()=>h,uint16_t:()=>U,uint32_t:()=>T,uint64_t:()=>D,uint8_t:()=>S,ulong:()=>O,ulonglong:()=>y,ushort:()=>l});var s={};n.r(s),n.d(s,{BOOL:()=>j,BYTE:()=>R,CHAR:()=>I,DWORD:()=>A,FLOAT:()=>G,INT:()=>$,LONG:()=>P,LONGLONG:()=>F,QWORD:()=>E,SHORT:()=>C,UCHAR:()=>B,UINT:()=>v,ULONG:()=>W,ULONGLONG:()=>Y,USHORT:()=>H,WORD:()=>z,char:()=>g,double:()=>L,float:()=>m,int:()=>f,int16_t:()=>N,int32_t:()=>x,int64_t:()=>w,int8_t:()=>b,long:()=>p,longlong:()=>_,short:()=>d,string_t:()=>c,uchar:()=>a,uint:()=>h,uint16_t:()=>U,uint32_t:()=>T,uint64_t:()=>D,uint8_t:()=>S,ulong:()=>O,ulonglong:()=>y,ushort:()=>l});class r{constructor(t,e,n,s,r,i){this.names=e,this.size=n,this.unsigned=s,this.get=r,this.set=i,this.deeps=[],this.deeps.push(t);const o=new Proxy(this,{get:(t,e)=>e in t?t[e]:(e=e.toString(),/\d+/.test(e)&&t.deeps.push(parseInt(e)),o)});return o}}class i extends Array{constructor(t,e,n){super(),this.size=e,this.unsigned=n,this.deeps=[],this.names=Array.isArray(t)?t:[t];const{set:s,get:o}=function(t){switch(t.size){case 1:return{get:t.unsigned?"getUint8":"getInt8",set:t.unsigned?"setUint8":"setInt8"};case 2:return{get:t.unsigned?"getUint16":"getInt16",set:t.unsigned?"setUint16":"setInt16"};case 4:const e=t.isName("float");return{get:e?"getFloat32":t.unsigned?"getUint32":"getInt32",set:e?"setFloat32":t.unsigned?"setUint32":"setInt32"};case 8:const n=t.isName("double");return{get:n?"getFloat64":t.unsigned?"getBigUint64":"getBigInt64",set:n?"setFloat64":t.unsigned?"setBigUint64":"setBigInt64"};default:throw new Error(`StructBuffer: Unrecognized ${t} type.`)}}(this);return this.set=s,this.get=o,new Proxy(this,{get(t,e){if(e in t)return t[e];if(e=e.toString(),/\d+/.test(e)){const n=new r(parseInt(e),t.names,t.size,t.unsigned,t.get,t.set);return Object.setPrototypeOf(n,i.prototype),n}}})}get isList(){return!!this.deeps.length}get count(){return this.deeps.reduce(((t,e)=>t*e),1)}is(t){for(const e of t.names)if(this.names.includes(e))return!0;return!1}isName(t){return this.names.includes(t)}}function o(t,e,n=!0){return new i(t,e,n)}function u(t,e){return o(t,e.size,e.unsigned)}const c=o("string_t",1),g=o(["char","signed char"],1,!1),a=o("unsigned char",1),d=o(["short","short int","signed short","signed short int"],2,!1),l=o(["unsigned short","unsigned short int"],2),f=o(["int","signed","signed int"],4,!1),h=o(["unsigned","unsigned int"],4),p=o(["long","long int","signed long","signed long int"],4,!1),O=o(["unsigned long","unsigned long int"],4),_=o(["long long","long long int","signed long long","signed long long int"],8,!1),y=o(["unsigned long long","unsigned long long int"],8),m=o("float",4),L=o(["double","long double"],8),b=u(["int8_t","__int8"],g),N=u(["int16_t","__int16"],d),x=u(["int32_t","__int32"],f),w=u(["int64_t","__int64"],_),S=u(["uint8_t","unsigned __int8"],a),U=u(["uint16_t","unsigned __int16"],l),T=u(["uint32_t","unsigned __int32"],h),D=u(["uint64_t","unsigned __int64"],y),j=u("BOOL",f),R=u("BYTE",a),z=u("WORD",l),A=u("DWORD",O),E=o("QWORD",8),G=u("FLOAT",m),I=u("CHAR",g),B=u("UCHAR",a),C=u("SHORT",d),H=u("USHORT",l),$=u("INT",f),v=u("UINT",h),P=u("LONG",p),W=u("ULONG",O),F=u("LONGLONG",_),Y=u("ULONGLONG",y);function M(t){if(t instanceof k){let e=0;const n=t.maxSize;for(;(t.byteLength+e)%n!=0;)e++;return t.byteLength+e}return t.isList?t.size*t.count:t.size}function Q(t,e,n=!0,s=!1){let r=0;const i=[];for(;;)try{let o=t[e.get](r,s);!n||m.is(e)||L.is(e)||(o=o.toString(16).toUpperCase().padStart(2*e.size,"0")),i.push({offset:r,value:o}),r+=e.size}catch(t){break}return i}class V{constructor(t,e,n){this.i=t,this.structName=e,this.struct=n}}class k extends Array{constructor(t,e){return super(),this.structName=t,this.struct=e,this._textDecode=new TextDecoder,this._textEncoder=new TextEncoder,new Proxy(this,{get(t,e){if(e in t)return t[e];if(e=e.toString(),/\d+/.test(e)){const n=new V(parseInt(e),t.structName,t.struct);return n._textDecode=t._textDecode,n._textEncoder=t._textEncoder,Object.setPrototypeOf(n,k.prototype),n}}})}get isList(){return!!this.i}get count(){return this.i??1}get textDecode(){return this._textDecode}set textDecode(t){this._textDecode=t}_decode(t){return this.textDecode.decode(t)}get textEncoder(){return this._textEncoder}set textEncoder(t){this._textEncoder=t}_encode(t){return this.textEncoder.encode(t)}get byteLength(){return Object.values(this.struct).reduce(((t,e)=>t+=e instanceof k?e.byteLength:M(e)),0)*this.count}get maxSize(){return Math.max(...Object.values(this.struct).map((t=>t instanceof k?t.maxSize:t.size)))}decode(t,e=!1,n=0){t instanceof DataView||(t=new DataView(t.buffer));return Object.entries(this.struct).reduce(((s,[r,i])=>{if(i instanceof k)if(i.isList){s[r]=[];for(let o=0;o<i.count;o++)s[r].push(i.decode(t,e,n)),n+=i.byteLength/i.count}else s[r]=i.decode(t,e,n),n+=i.byteLength;else{let o;const u=c.is(i);if(i.isList){o=[];for(let s=0;s<i.count;s++){const s=t[i.get](n,e);o.push(s),n+=i.size}if(u&&(o=this._decode(new Uint8Array(o)),i.deeps.length<2))return s[r]=o,s;o=function(t,e,n=!1){let s=t;n&&"string"==typeof s&&(s=s.split(""));for(let t=e.length-1;t>=1;t--){const r=t===e.length-1,i=e[t];s=s.reduce(((t,e,n)=>(n%i==0&&t.push([]),t[t.length-1].push(e),t)),[]),n&&r&&(s=s.map((t=>t.join(""))))}return s}(o,i.deeps,u)}else o=t[i.get](n,e),u&&(o=this._decode(new Uint8Array([o]))),n+=i.size;s[r]=o}return s}),{})}encode(t,e=!1,n=0,s){const r=s||new DataView(new ArrayBuffer(this.byteLength));return Object.entries(this.struct).reduce(((s,[r,i])=>{let o=t[r];if(i instanceof k)if(i.isList)for(let t=0;t<i.count;t++)i.encode(o[t],e,n,s),n+=i.byteLength/i.count;else i.encode(o,e,n,s),n+=i.byteLength;else{const t=c.is(i);if(i.isList){Array.isArray(o)&&(o=o.flat(),t&&(o=o.join(""))),t&&(o=this._encode(o));for(let t=0;t<i.count;t++){const r=o[t]??0;s[i.set](n,r,e),n+=i.size}}else t&&(o=this._encode(o)[0]),s[i.set](n,o,e),n+=i.size}return s}),r)}toCStruct(){let t="";for(let[e,n]of Object.entries(this.struct)){const s=n instanceof i?n.names[0]:n.structName;n.isList&&(e=`${e}[${n.count}]`),t+=`\t${s} ${e};\n`}return`\ntypedef struct _${this.structName}\n{\n${t.replace(/\n$/,"")}\n} ${this.structName}, *${this.structName};\n`}}const q=s,J=/\s*(?<typedef>typedef)?\s*(?<struct>struct)\s*(?<structName>\w+)\s*{(?<props>[^}]*)}(\s*(?<aliasName1>\w+)?\s*,\s*(?<aliasName2>\*\w+)?\s*;\s*)?/gi;function K(t,e){e=Object.assign(q,e);const n=[...(t=t.replace(/\/\/[^]*?\n|\/\*[^]*\*\//g,"")).matchAll(J)];if(!n||!n.length)throw new Error("[parseCStruct]: parse error");const s={};for(const t of n){const e=t.groups;if(!e?.struct)throw new Error('[parseCStruct]: Undefined identifier "struct"');const n=e?.aliasName1??e?.structName;if(!n)throw new Error('[parseCStruct]: You need to create a name for "struct"');const r={};e.props&&e.props.trim()&&e.props.trim().split(/\n/).map((t=>{const e=t.trim().replace(/;$/,"").split(/\s+/).map((t=>t.trim()));let n=e.pop(),s=e.join(" "),r=1,i=!1;const o=n.match(/\[(\d+)+\]/);return o&&(n=n.substr(0,o.index),r=parseInt(o[1])||1,i=!0),{type:s,name:n,count:r,isList:i}})).forEach((t=>{r[t.name]=t})),s[n]=r}const r=Object.keys(s).reduce(((t,e)=>Object.assign(t,{[e]:null})),{});for(const[t,n]of Object.entries(s))r[t]=new k(t,Object.entries(n).reduce(((t,[n,o])=>{if(o.type in s)return t[n]=r[o.type],t;if(!e)return t;let u=e[o.type];if(u||(u=Object.values(e).find((t=>{if(t instanceof i&&t.isName(o.type))return t}))),!u)throw new Error(`[parseCStruct]: The (${o.type}) type was not found in styles`);return t[n]=o.isList?u[o.count]:u,t}),{}));return r}}},e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={exports:{}};return t[s](r,r.exports,n),r.exports}return n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(608)})()}));